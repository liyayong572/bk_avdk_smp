// Copyright 2025-2026 Beken
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

#ifndef __BK_PLAYER_SERVICE_TYPES__
#define __BK_PLAYER_SERVICE_TYPES__

#include <components/bk_audio/audio_pipeline/audio_types.h>
#include <components/bk_audio/audio_streams/onboard_speaker_stream.h>
#include <components/bk_audio/audio_streams/uac_speaker_stream.h>

#ifdef  __cplusplus
extern "C" {
#endif//__cplusplus

/**
 * @brief Generic Player Service Types
 * 
 * This file defines the common data types, enumerations, and structures used by the
 * player service module. These types are used to configure and control player service
 * operations including playing audio data from various sources.
 */

/**
 * @brief Player service state enumeration
 *
 * This enumeration defines the operational states of the player service.
 */
typedef enum
{
    PLAYER_STATE_NONE = 0,    /*!< Player service is in an undefined state */
    PLAYER_STATE_IDLE,        /*!< Player service is initialized but not active */
    PLAYER_STATE_STOPED,      /*!< Player service has been stopped */
    PLAYER_STATE_PLAYING,     /*!< Player service is actively playing audio */
    PLAYER_STATE_PAUSED,      /*!< Player service is paused */
} bk_player_state_t;

/**
 * @brief Player service event enumeration
 *
 * This enumeration defines the events that can be generated by the player service.
 */
typedef enum
{
    PLAYER_EVENT_START = 0,   /*!< Player service start event */
    PLAYER_EVENT_STOP,        /*!< Player service stop event */
    PLAYER_EVENT_FAILURE,     /*!< Player service failure event */
    PLAYER_EVENT_PAUSE,       /*!< Player service pause event */
    PLAYER_EVENT_RESUME,      /*!< Player service resume event */
    PLAYER_EVENT_FINISH,      /*!< Player service finish event */

    PLAYER_EVENT_MUSIC_INFO,  /*!< Player service music information event */
} bk_player_event_t;

/**
 * @brief Player URI type enumeration
 *
 * This enumeration defines the types of audio sources supported by the player service.
 */
typedef enum
{
    PLAYER_URI_TYPE_ARRAY = 0,  /*!< Array stream source type */
    PLAYER_URI_TYPE_VFS,        /*!< VFS (Virtual File System) source type */
    PLAYER_URI_TYPE_URL,        /*!< URL source type */
} player_uri_type_t;

/**
 * @brief Player URI information structure
 *
 * This structure defines the URI information for audio playback.
 */
typedef struct
{
    player_uri_type_t uri_type; /*!< URI type */
    char *uri;                  /*!< URI string */
    uint32_t total_len;         /*!< Total length of audio data */
} player_uri_info_t;

/**
 * @brief Player handle type
 *
 * This typedef defines a pointer to the player service structure.
 */
typedef struct player *bk_player_handle_t;

/**
 * @brief Player event handler callback type
 *
 * This typedef defines the function pointer type for handling player service events.
 *
 * @param event Event type
 * @param data Event data
 * @param args User defined arguments
 * @return int Returns 0 on success, other values indicate error
 */
typedef int (*player_event_handle_cb)(int event, void *data, void *args);

/**
 * @brief Player service configuration structure
 *
 * This structure defines the complete configuration for the player service,
 * including speaker settings and event handling.
 */
typedef struct
{
    spk_type_t                          spk_type;           /*!< Speaker type */

    union
    {
        onboard_speaker_stream_cfg_t    onboard_spk_cfg;    /*!< Onboard speaker configuration */
        uac_speaker_stream_cfg_t        uac_spk_cfg;        /*!< USB audio class speaker configuration */
        uint8_t                         reserve;            /*!< Reserved for future use */
    } spk_cfg;                                              /*!< Speaker configuration union */

    player_event_handle_cb              event_handle;       /*!< Player event handle callback function */
    void *                              args;               /*!< User defined arguments for the event handle function */
} bk_player_cfg_t;

/**
 * @brief Default player configuration without playback
 *
 * This configuration creates a player that reads and decodes audio data to PCM data,
 * but does not play back the PCM data.
 */
#define DEFAULT_PLAYER_NOT_PLAYBACK_CONFIG() {                  \
    .spk_type = SPK_TYPE_INVALID,                               \
    .spk_cfg.reserve = 0,                                       \
    .event_handle = NULL,                                       \
    .args = NULL,                                               \
}

/**
 * @brief Default player configuration with playback
 *
 * This configuration creates a player that reads, decodes and plays back audio data
 * using the onboard speaker with default settings.
 */
#define DEFAULT_PLAYER_WITH_PLAYBACK_CONFIG() {                 \
    .spk_type = SPK_TYPE_ONBOARD,                               \
    .spk_cfg.onboard_spk_cfg = {                                \
        .chl_num = 1,                                           \
        .sample_rate = 8000,                                    \
        .dig_gain = 0x2d,                                       \
        .ana_gain = 0x07,                                       \
        .work_mode = AUD_DAC_WORK_MODE_DIFFEN,                  \
        .bits = 16,                                             \
        .clk_src = AUD_CLK_XTAL,                                \
        .multi_out_port_num = 1,                                \
        .frame_size = 320,                                      \
        .pool_length = 0,                                       \
        .pool_play_thold = 0,                                   \
        .pool_pause_thold = 0,                                  \
        .task_stack = ONBOARD_SPEAKER_STREAM_TASK_STACK,        \
        .task_core = ONBOARD_SPEAKER_STREAM_TASK_CORE,          \
        .task_prio = ONBOARD_SPEAKER_STREAM_TASK_PRIO,          \
    },                                                          \
    .event_handle = NULL,                                       \
    .args = NULL,                                               \
}

#ifdef  __cplusplus
}
#endif//__cplusplus

#endif

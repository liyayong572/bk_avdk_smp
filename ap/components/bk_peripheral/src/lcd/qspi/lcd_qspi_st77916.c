// Copyright 2020-2021 Beken
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.


#include <common/bk_include.h>
#include <driver/lcd_types.h>


#define LCD_QSPI_ST77916_REGISTER_WRITE_COMMAND        0x02
#define LCD_QSPI_ST77916_REGISTER_READ_COMMAND         0x0B


static const lcd_qspi_init_cmd_t st77916_init_cmds[] =
{
    {0xF0, {0x08}, 1},
    {0xF2, {0x08}, 1},
    {0x9B, {0x51}, 1},
    {0x86, {0x53}, 1},
    {0xF2, {0x80}, 1},
    {0xF0, {0x00}, 1},
    {0xF0, {0x01}, 1},
    {0xF1, {0x01}, 1},
    {0xB0, {0x55}, 1},
    {0xB1, {0x1E}, 1},
    {0xB2, {0x3B}, 1},
    {0xB4, {0x06}, 1},
    {0xB5, {0x24}, 1},
    {0xB6, {0xA5}, 1},
    {0xB7, {0x10}, 1},
    {0xBA, {0x00}, 1},
    {0xBB, {0x08}, 1},
    {0xBC, {0x08}, 1},
    {0xBD, {0x00}, 1},
    {0xC0, {0x80}, 1},
    {0xC1, {0x10}, 1},
    {0xC2, {0x37}, 1},
    {0xC3, {0x80}, 1},
    {0xC4, {0x10}, 1},
    {0xC5, {0x37}, 1},
    {0xC6, {0xA9}, 1},
    {0xC7, {0x41}, 1},
    {0xC8, {0x51}, 1},
    {0xC9, {0xA9}, 1},
    {0xCA, {0x41}, 1},
    {0xCB, {0x51}, 1},
    {0xD0, {0x91}, 1},
    {0xD1, {0x68}, 1},
    {0xD2, {0x69}, 1},
    {0xF5, {0x00, 0xA5}, 2},
    {0xDD, {0x3b}, 1},
    {0xDE, {0x3b}, 1},
    {0xF1, {0x10}, 1},
    {0xF0, {0x00}, 1},
    {0xF0, {0x02}, 1},
    {0xE0, {0xf0, 0x0b, 0x12, 0x0b, 0x0a, 0x06, 0x39, 0x43, 0x4f, 0x07, 0x14, 0x14, 0x2f, 0x34}, 14},
    {0xE1, {0xf0, 0x0b, 0x11, 0x0a, 0x09, 0x05, 0x32, 0x33, 0x48, 0x07, 0x13, 0x13, 0x2c, 0x33}, 14},
    {0xF0, {0x10}, 1},
    {0xF3, {0x10}, 1},
    {0xE0, {0x0A}, 1},
    {0xE1, {0x00}, 1},
    {0xE2, {0x00}, 1},
    {0xE3, {0x00}, 1},
    {0xE4, {0xE0}, 1},
    {0xE5, {0x06}, 1},
    {0xE6, {0x21}, 1},
    {0xE7, {0x00}, 1},
    {0xE8, {0x05}, 1},
    {0xE9, {0x82}, 1},
    {0xEA, {0xDF}, 1},
    {0xEB, {0x89}, 1},
    {0xEC, {0x20}, 1},
    {0xED, {0x14}, 1},
    {0xEE, {0xFF}, 1},
    {0xEF, {0x00}, 1},
    {0xF8, {0xFF}, 1},
    {0xF9, {0x00}, 1},
    {0xFA, {0x00}, 1},
    {0xFB, {0x30}, 1},
    {0xFC, {0x00}, 1},
    {0xFD, {0x00}, 1},
    {0xFE, {0x00}, 1},
    {0xFF, {0x00}, 1},
    {0x60, {0x42}, 1},
    {0x61, {0xE0}, 1},
    {0x62, {0x40}, 1},
    {0x63, {0x40}, 1},
    {0x64, {0x02}, 1},
    {0x65, {0x00}, 1},
    {0x66, {0x40}, 1},
    {0x67, {0x03}, 1},
    {0x68, {0x00}, 1},
    {0x69, {0x00}, 1},
    {0x6A, {0x00}, 1},
    {0x6B, {0x00}, 1},
    {0x70, {0x42}, 1},
    {0x71, {0xE0}, 1},
    {0x72, {0x40}, 1},
    {0x73, {0x40}, 1},
    {0x74, {0x02}, 1},
    {0x75, {0x00}, 1},
    {0x76, {0x40}, 1},
    {0x77, {0x03}, 1},
    {0x78, {0x00}, 1},
    {0x79, {0x00}, 1},
    {0x7A, {0x00}, 1},
    {0x7B, {0x00}, 1},
    {0x80, {0x48}, 1},
    {0x81, {0x00}, 1},
    {0x82, {0x05}, 1},
    {0x83, {0x02}, 1},
    {0x84, {0xDD}, 1},
    {0x85, {0x00}, 1},
    {0x86, {0x00}, 1},
    {0x87, {0x00}, 1},
    {0x88, {0x48}, 1},
    {0x89, {0x00}, 1},
    {0x8A, {0x07}, 1},
    {0x8B, {0x02}, 1},
    {0x8C, {0xDF}, 1},
    {0x8D, {0x00}, 1},
    {0x8E, {0x00}, 1},
    {0x8F, {0x00}, 1},
    {0x90, {0x48}, 1},
    {0x91, {0x00}, 1},
    {0x92, {0x09}, 1},
    {0x93, {0x02}, 1},
    {0x94, {0xE1}, 1},
    {0x95, {0x00}, 1},
    {0x96, {0x00}, 1},
    {0x97, {0x00}, 1},
    {0x98, {0x48}, 1},
    {0x99, {0x00}, 1},
    {0x9A, {0x0B}, 1},
    {0x9B, {0x02}, 1},
    {0x9C, {0xE3}, 1},
    {0x9D, {0x00}, 1},
    {0x9E, {0x00}, 1},
    {0x9F, {0x00}, 1},
    {0xA0, {0x48}, 1},
    {0xA1, {0x00}, 1},
    {0xA2, {0x04}, 1},
    {0xA3, {0x02}, 1},
    {0xA4, {0xDC}, 1},
    {0xA5, {0x00}, 1},
    {0xA6, {0x00}, 1},
    {0xA7, {0x00}, 1},
    {0xA8, {0x48}, 1},
    {0xA9, {0x00}, 1},
    {0xAA, {0x06}, 1},
    {0xAB, {0x02}, 1},
    {0xAC, {0xDE}, 1},
    {0xAD, {0x00}, 1},
    {0xAE, {0x00}, 1},
    {0xAF, {0x00}, 1},
    {0xB0, {0x48}, 1},
    {0xB1, {0x00}, 1},
    {0xB2, {0x08}, 1},
    {0xB3, {0x02}, 1},
    {0xB4, {0xE0}, 1},
    {0xB5, {0x00}, 1},
    {0xB6, {0x00}, 1},
    {0xB7, {0x00}, 1},
    {0xB8, {0x48}, 1},
    {0xB9, {0x00}, 1},
    {0xBA, {0x0A}, 1},
    {0xBB, {0x02}, 1},
    {0xBC, {0xE2}, 1},
    {0xBD, {0x00}, 1},
    {0xBE, {0x00}, 1},
    {0xBF, {0x00}, 1},
    {0xC0, {0x12}, 1},
    {0xC1, {0xAA}, 1},
    {0xC2, {0x65}, 1},
    {0xC3, {0x74}, 1},
    {0xC4, {0x47}, 1},
    {0xC5, {0x56}, 1},
    {0xC6, {0x00}, 1},
    {0xC7, {0x88}, 1},
    {0xC8, {0x99}, 1},
    {0xC9, {0x33}, 1},
    {0xD0, {0x21}, 1},
    {0xD1, {0xAA}, 1},
    {0xD2, {0x65}, 1},
    {0xD3, {0x74}, 1},
    {0xD4, {0x47}, 1},
    {0xD5, {0x56}, 1},
    {0xD6, {0x00}, 1},
    {0xD7, {0x88}, 1},
    {0xD8, {0x99}, 1},
    {0xD9, {0x33}, 1},
    {0xF3, {0x01}, 1},
    {0xF0, {0x00}, 1},
    {0xF0, {0x01}, 1},
    {0xF1, {0x01}, 1},
    {0xA0, {0x0B}, 1},
    {0xA3, {0x2A}, 1},
    {0xA5, {0xC3}, 1},
    {0xA3, {0x2B}, 1},
    {0xA5, {0xC3}, 1},
    {0xA3, {0x2C}, 1},
    {0xA5, {0xC3}, 1},
    {0xA3, {0x2D}, 1},
    {0xA5, {0xC3}, 1},
    {0xA3, {0x2E}, 1},
    {0xA5, {0xC3}, 1},
    {0xA3, {0x2F}, 1},
    {0xA5, {0xC3}, 1},
    {0xA3, {0x30}, 1},
    {0xA5, {0xC3}, 1},
    {0xA3, {0x31}, 1},
    {0xA5, {0xC3}, 1},
    {0xA3, {0x32}, 1},
    {0xA5, {0xC3}, 1},
    {0xA3, {0x33}, 1},
    {0xA5, {0xC3}, 1},
    {0xA0, {0x09}, 1},
    {0xF1, {0x10}, 1},
    {0xF0, {0x00}, 1},
    {0x2A, {0x00, 0x00, 0x01, 0x67}, 4},
    {0x2B, {0x01, 0x68, 0x01, 0x68}, 4},
    {0x4D, {0x00}, 1},
    {0x4E, {0x00}, 1},
    {0x4F, {0x00}, 1},
    {0x4C, {0x01}, 1},
    {0x4C, {0x00}, 1},
    {0x2A, {0x00, 0x00, 0x01, 0x67}, 4},
    {0x2B, {0x00, 0x00, 0x01, 0x67}, 4},
    {0x36, {0x00}, 1},
    {0x3A, {0x55}, 1},
    {0x35, {0x00}, 1},
    {0x21, {0x00}, 0},
    {0x11, {0x00}, 0},
    {0x00, {0x78}, 0xFF},
    {0x29, {0x00}, 0},
};

static uint8_t st77916_cmd[4] = {0x32, 0x00, 0x2c, 0x00};

static const lcd_qspi_t lcd_qspi_st77916_config =
{
    .clk = LCD_QSPI_48M,
    .refresh_method = LCD_QSPI_REFRESH_BY_FRAME,
    .reg_write_cmd = LCD_QSPI_ST77916_REGISTER_WRITE_COMMAND,
    .reg_read_cmd = LCD_QSPI_ST77916_REGISTER_READ_COMMAND,
    .reg_read_config.dummy_clk = 0,
    .reg_read_config.dummy_mode = LCD_QSPI_NO_INSERT_DUMMMY_CLK,
    .pixel_write_config.cmd = st77916_cmd,
    .pixel_write_config.cmd_len = sizeof(st77916_cmd),
    .init_cmd = st77916_init_cmds,
    .device_init_cmd_len = sizeof(st77916_init_cmds) / sizeof(lcd_qspi_init_cmd_t),
    .refresh_config = {0},
    .frame_len = 360 * 360 * CONFIG_LCD_QSPI_COLOR_DEPTH_BYTE,
};

const lcd_device_t lcd_device_st77916 =
{
    .id = LCD_DEVICE_ST77916,
    .name = "st77916",
    .type = LCD_TYPE_QSPI,
    .width = 360,
    .height = 360,
    .qspi = &lcd_qspi_st77916_config,
    .init = NULL,
    .off = NULL,
};


